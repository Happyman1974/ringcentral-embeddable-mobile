{"version":3,"sources":["webpack://ringcentral-embeddable-mobile/./src/client/app/common.js","webpack://ringcentral-embeddable-mobile/./src/client/app/check-permission.js","webpack://ringcentral-embeddable-mobile/./src/client/app/event-handler.js","webpack://ringcentral-embeddable-mobile/./src/client/work.js"],"names":["wait","ms","Promise","resolve","setTimeout","waitUntilLoad","inited","window","cordova","plugins","iosrtc","console","log","loadScript","url","script","document","createElement","type","src","async","body","appendChild","checkPermission","registerGlobals","audioinput","checkMicrophonePermission","hasPermission","getMicrophonePermission","message","warn","postMessage","data","getCode","key","c","localStorage","getItem","setItem","login","msg","callbackUri","rc","getUrl","authUrlDefaultRc","replace","defaultState","view","onEvent","e","debug","oAuthUri","location","href","handleEvent","JSON","parse","stringify","addEventListener","run"],"mappings":"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","file":"js/work.bundle.js","sourcesContent":["\nexport function wait (ms) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms)\n  })\n}\n\nexport async function waitUntilLoad () {\n  let inited = false\n  while (!inited) {\n    if (window.cordova && window.cordova.plugins && window.cordova.plugins.iosrtc) {\n      inited = true\n    } else {\n      console.log('wait')\n      await wait(50)\n    }\n  }\n  return true\n}\n\nexport function loadScript (url) {\n  const script = document.createElement('script')\n  script.type = 'text/javascript'\n  script.src = 'app.js'\n  script.async = false\n  document.body.appendChild(script)\n}\n","\nexport function checkPermission () {\n  // First check whether we already have permission to access the microphone.\n  cordova.plugins.iosrtc.registerGlobals()\n  window.audioinput.checkMicrophonePermission((hasPermission) => {\n    if (hasPermission) {\n      console.log('We already have permission to record.')\n      // startCapture()\n    } else {\n      // Ask the user for permission to access the microphone\n      window.audioinput.getMicrophonePermission((hasPermission, message) => {\n        if (hasPermission) {\n          console.log('User granted us permission to record.')\n        } else {\n          console.warn('User denied permission to record.')\n        }\n      })\n    }\n  })\n}\n","/**\n * handle events\n */\n\nfunction postMessage (data) {\n  window.postMessage(data, '*')\n}\n\nexport function getCode () {\n  const key = 'rc-authcode'\n  const c = window.localStorage.getItem(key)\n  if (c) {\n    window.localStorage.setItem(key, '')\n    return c\n  } else {\n    return ''\n  }\n}\n\nexport function login (msg = postMessage) {\n  const c = getCode()\n  if (c) {\n    msg({\n      type: 'rc-adapter-authorization-code',\n      callbackUri: `${window.rc.callbackUri}?code=${c}`\n    })\n  }\n}\n\nexport function getUrl () {\n  return window.rc.authUrlDefaultRc.replace(\n    window.rc.defaultState,\n    window.rc.view\n  )\n}\n\nfunction onEvent (e) {\n  const { data } = e\n  console.debug('got data from ev', data)\n  if (data) {\n    switch (data.type) {\n      case 'rc-login-popup-notify':\n        // get login oAuthUri from widget\n        console.log('rc-login-popup-notify:', data.oAuthUri)\n        window.location.href = getUrl()\n        //  window.open(data.oAuthUri); // open oauth uri to login\n        break\n      case 'rc-adapter-pushAdapterState':\n        setTimeout(login, 100)\n        break\n      default:\n        break\n    }\n  }\n}\n\nexport function handleEvent () {\n  window.rc = JSON.parse(\n    window.localStorage.getItem('rc-data-ref', JSON.stringify(window.rc))\n  )\n  // window.top = window\n  // window.parent = window\n  window.addEventListener('message', onEvent)\n}\n","\n/**\n * replace app default script\n */\n\nimport { waitUntilLoad, loadScript } from './app/common'\nimport { checkPermission } from './app/check-permission'\nimport { handleEvent } from './app/event-handler'\n\nasync function run () {\n  await waitUntilLoad()\n  checkPermission()\n  loadScript('https://webrtc.github.io/adapter/adapter-latest.js')\n  loadScript('app.js')\n  handleEvent()\n}\n\nrun()\n"],"sourceRoot":""}